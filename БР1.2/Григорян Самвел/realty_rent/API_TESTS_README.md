# API Tests для RealtyRent

Этот набор тестов предназначен для тестирования API системы управления недвижимостью RealtyRent.

## Файлы

- `RealtyRent_API_Tests.postman_collection.json` - основная коллекция тестов
- `RealtyRent_API_Environment.postman_environment.json` - переменные окружения
- `API_TESTS_README.md` - данная инструкция

## Установка и настройка

### 1. Импорт в Postman

1. Откройте Postman
2. Нажмите "Import" в левом верхнем углу
3. Импортируйте файл `RealtyRent_API_Tests.postman_collection.json`
4. Импортируйте файл `RealtyRent_API_Environment.postman_environment.json`

### 2. Настройка окружения

1. В правом верхнем углу выберите окружение "RealtyRent API Environment"
2. Убедитесь, что переменная `baseUrl` установлена в `http://localhost:3000/api`
3. При необходимости измените учетные данные администратора в переменных `adminUsername` и `adminPassword`

### 3. Запуск сервера

Убедитесь, что ваш Express.js сервер запущен:

```bash
cd realty_rent
npm install
npm run dev
```

## Структура тестов

### 1. Health Check
- Проверка доступности сервера

### 2. Authentication
- **Login - Success**: Успешная аутентификация
- **Login - Invalid Credentials**: Тест с неверными учетными данными

### 3. Users
- **Get All Users**: Получение всех пользователей
- **Get Agents**: Получение только агентов
- **Get Clients**: Получение только клиентов
- **Create User**: Создание нового пользователя
- **Get User by ID**: Получение пользователя по ID
- **Update User**: Обновление данных пользователя
- **Delete User**: Удаление пользователя

### 4. Buildings
- **Get All Buildings**: Получение всех зданий
- **Create Building**: Создание нового здания
- **Get Building by ID**: Получение здания по ID
- **Update Building**: Обновление данных здания

### 5. Apartments
- **Get All Apartments**: Получение всех квартир
- **Create Apartment**: Создание новой квартиры
- **Get Apartment by ID**: Получение квартиры по ID
- **Update Apartment**: Обновление данных квартиры

### 6. Contracts
- **Get All Contracts**: Получение всех контрактов
- **Create Contract**: Создание нового контракта
- **Get Contract by ID**: Получение контракта по ID
- **Update Contract**: Обновление данных контракта

### 7. Error Handling
- **Get Non-existent User**: Тест 404 ошибки
- **Unauthorized Access**: Тест 401 ошибки
- **Invalid JSON**: Тест валидации данных

## Запуск тестов

### Запуск всей коллекции

1. Откройте коллекцию "RealtyRent API Tests"
2. Нажмите на кнопку "Run collection" (▶️)
3. Выберите окружение "RealtyRent API Environment"
4. Нажмите "Run RealtyRent API Tests"

### Запуск отдельных тестов

1. Откройте нужный тест в коллекции
2. Нажмите "Send" для выполнения запроса
3. Проверьте результаты в разделе "Test Results"

## Важные моменты

### Автоматическое сохранение ID

Тесты автоматически сохраняют ID созданных объектов в переменные окружения:
- `testUserId` - ID созданного пользователя
- `testBuildingId` - ID созданного здания
- `testApartmentId` - ID созданной квартиры
- `testContractId` - ID созданного контракта

### Аутентификация

После успешного входа токен автоматически сохраняется в переменную `authToken` и используется в последующих запросах.

### Порядок выполнения

Рекомендуется выполнять тесты в следующем порядке:
1. Health Check
2. Authentication (Login)
3. Users (создание, чтение, обновление, удаление)
4. Buildings (создание, чтение, обновление)
5. Apartments (создание, чтение, обновление)
6. Contracts (создание, чтение, обновление)
7. Error Handling

## Ожидаемые результаты

### Успешные тесты
- ✅ Status code соответствует ожидаемому
- ✅ Response содержит необходимые поля
- ✅ Данные корректно сохраняются и обновляются

### Тесты ошибок
- ✅ 404 для несуществующих ресурсов
- ✅ 401 для неавторизованных запросов
- ✅ 400/422 для невалидных данных

## Настройка для разных окружений

### Development
```json
{
  "baseUrl": "http://localhost:3000/api"
}
```

### Production
```json
{
  "baseUrl": "https://your-domain.com/api"
}
```

### Staging
```json
{
  "baseUrl": "https://staging.your-domain.com/api"
}
```

## Устранение неполадок

### Сервер не отвечает
1. Убедитесь, что сервер запущен
2. Проверьте порт в переменной `baseUrl`
3. Проверьте логи сервера

### Ошибки аутентификации
1. Проверьте учетные данные в переменных окружения
2. Убедитесь, что пользователь существует в базе данных
3. Проверьте правильность JWT токена

### Ошибки валидации
1. Проверьте формат отправляемых данных
2. Убедитесь, что все обязательные поля заполнены
3. Проверьте типы данных

## Дополнительные возможности

### Автоматизация тестов

Можно настроить автоматический запуск тестов через:
- Newman (CLI для Postman)
- CI/CD пайплайны
- GitHub Actions

### Мониторинг

Тесты можно использовать для:
- Мониторинга доступности API
- Проверки производительности
- Валидации изменений в API

## Поддержка

При возникновении проблем:
1. Проверьте логи сервера
2. Убедитесь в корректности настроек окружения
3. Проверьте версии зависимостей
4. Обратитесь к документации API 